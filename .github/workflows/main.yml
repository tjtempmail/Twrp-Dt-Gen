name: Make TWRP Device

# ðŸ‘‡ YEH PERMISSIONS BLOCK ADD KAREIN (iss line se lekar end tak)
permissions:
  contents: write          # Release banane ke liye ye zaroori hai
  actions: read
  checks: read
  pull-requests: read
  statuses: read

on:
  workflow_dispatch:
    inputs:
      IMG_URL:
        description: 'Direct URL to boot/recovery image'
        required: true
      # IMG_FILE hata diya kyunki mobile par kaam nahi karta

jobs:
  build:
    if: github.event.repository.owner.id == github.event.sender.id
    runs-on: ubuntu-22.04

    steps:
    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install -y python3 python3-pip cpio wget aria2
        pip3 install twrpdtgen

    - name: Download image from URL
      run: |
        aria2c -o image.img "${{ github.event.inputs.IMG_URL }}"

    - name: Generate device tree
      run: |
        mkdir -p dt
        python3 -m twrpdtgen -o dt/ image.img

    - name: Zip device tree
      run: |
        zip -r DeviceTree.zip dt/

    - name: Create Release
      uses: softprops/action-gh-release@v2
      with:
        files: DeviceTree.zip
        name: TWRP Device Tree ${{ github.run_id }}
        tag_name: ${{ github.run_id }}
        body: Automatically generated device tree for TWRP.
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
